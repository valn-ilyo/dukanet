import{d as B,a as A,F,g as S,b as p,h as D,w,D as j,E as V,o as P,G as Z,H as W,r as L,I as J,y as z,i as M,c as R,x as O,C as T,J as q,e as H,z as Q,f as X,K as ee,L as te,M as C,q as se,t as re,u as ie}from"./index-CaBEtMt9.js";import{F as U,u as $,c as ae,a as k,b as G,d as ne,_ as oe,e as le,B as ce}from"./BusinessAdd5-BkpyQYUl.js";import{u as ue}from"./useUserInfo-BjA-Fyi7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de=B({__name:"BusinessAdd1",setup(u){return(e,t)=>(P(),A(F,null,[t[0]||(t[0]=S("div",{class:"text-h5 mb-4 barlow text-onSurface"},"Start building your Business Profile",-1)),t[1]||(t[1]=S("div",{class:"text-subtitle-2 mb-4 barlow text-onSurface"}," This will help you get discovered by customers ",-1)),p(D(U),{name:"name"},{default:w(({field:i,errorMessage:s})=>[p(j,V(i,{clearable:"",color:"primary",label:"Business name*",variant:"outlined",error:!!s,"error-messages":s}),null,16,["error","error-messages"])]),_:1}),t[2]||(t[2]=S("div",{class:"my-4"},null,-1)),p(D(U),{name:"handle"},{default:w(({field:i,errorMessage:s})=>[p(j,V(i,{prefix:"@",clearable:"",color:"primary",label:"Unique handle*",variant:"outlined",error:!!s,"error-messages":s}),null,16,["error","error-messages"])]),_:1})],64))}});function he(u,e,t,i){function s(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function c(o){try{d(i.next(o))}catch(h){a(h)}}function m(o){try{d(i.throw(o))}catch(h){a(h)}}function d(o){o.done?r(o.value):s(o.value).then(c,m)}d((i=i.apply(u,[])).next())})}function pe(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var me=function u(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var i,s,r;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(!u(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(r=Object.keys(e),i=r.length,i!==Object.keys(t).length)return!1;for(s=i;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[s]))return!1;for(s=i;s--!==0;){var a=r[s];if(!u(e[a],t[a]))return!1}return!0}return e!==e&&t!==t},fe=pe(me);const K="__googleMapsScriptId";var N;(function(u){u[u.INITIALIZED=0]="INITIALIZED",u[u.LOADING=1]="LOADING",u[u.SUCCESS=2]="SUCCESS",u[u.FAILURE=3]="FAILURE"})(N||(N={}));class E{constructor({apiKey:e,authReferrerPolicy:t,channel:i,client:s,id:r=K,language:a,libraries:c=[],mapIds:m,nonce:d,region:o,retries:h=3,url:y="https://maps.googleapis.com/maps/api/js",version:g}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=i,this.client=s,this.id=r||K,this.language=a,this.libraries=c,this.mapIds=m,this.nonce=d,this.region=o,this.retries=h,this.url=y,this.version=g,E.instance){if(!fe(this.options,E.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(E.instance.options)}`);return E.instance}E.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?N.FAILURE:this.done?N.SUCCESS:this.loading?N.LOADING:N.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(i=>{i?t(i.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id)){this.callback();return}const i={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(i).forEach(r=>!i[r]&&delete i[r]),!((t=(e=window==null?void 0:window.google)===null||e===void 0?void 0:e.maps)===null||t===void 0)&&t.importLibrary||(r=>{let a,c,m,d="The Google Maps JavaScript API",o="google",h="importLibrary",y="__ib__",g=document,b=window;b=b[o]||(b[o]={});const n=b.maps||(b.maps={}),l=new Set,f=new URLSearchParams,v=()=>a||(a=new Promise((_,I)=>he(this,void 0,void 0,function*(){var x;yield c=g.createElement("script"),c.id=this.id,f.set("libraries",[...l]+"");for(m in r)f.set(m.replace(/[A-Z]/g,Y=>"_"+Y[0].toLowerCase()),r[m]);f.set("callback",o+".maps."+y),c.src=this.url+"?"+f,n[y]=_,c.onerror=()=>a=I(Error(d+" could not load.")),c.nonce=this.nonce||((x=g.querySelector("script[nonce]"))===null||x===void 0?void 0:x.nonce)||"",g.head.append(c)})));n[h]?console.warn(d+" only loads once. Ignoring:",r):n[h]=(_,...I)=>l.add(_)&&v().then(()=>n[h](_,...I))})(i);const s=this.libraries.map(r=>this.importLibrary(r));s.length||s.push(this.importLibrary("core")),Promise.all(s).then(()=>this.callback(),r=>{const a=new ErrorEvent("error",{error:r});this.loadErrorCallback(a)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const t=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${t} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},t)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}const ge=B({__name:"BusinessAddMap",emits:["update:location"],setup(u,{emit:e}){const{coords:t}=Z(W()),{notify:i}=z(),s=L(null);let r,a,c;const m=L(!1),d=e;J(async()=>{try{const h=new E({apiKey:"AIzaSyA-0lsPhIXOkNtMMIfvdQa77I3pCMIFd7c",libraries:["marker"]}),[{Map:y,InfoWindow:g},{AdvancedMarkerElement:b}]=await Promise.all([h.importLibrary("maps"),h.importLibrary("marker")]),n={lat:t.value.latitude,lng:t.value.longitude};if(isNaN(n.lat)||isNaN(n.lng))throw new Error("Initial geolocation not available or invalid. Please ensure location services are enabled.");if(!s.value)throw new Error("Map display area not found.");r=new y(s.value,{center:n,zoom:18,mapId:"53158f9e5d1fe7904f773019",disableDefaultUI:!0,zoomControl:!0}),a=new b({map:r,position:n,title:"Your Business Location",gmpDraggable:!0}),c=new g({content:"Your Business Location"}),a.addListener("click",()=>{c.open(r,a)}),c.open(r,a),d("update:location",n),a.addListener("dragend",l=>{var _,I;const f=(_=l.latLng)==null?void 0:_.lat(),v=(I=l.latLng)==null?void 0:I.lng();if(typeof f=="number"&&typeof v=="number"){const x={lat:f,lng:v};d("update:location",x),c.setPosition(x),c.open(r,a)}else console.error("Could not get new position after marker dragend event.")})}catch(h){i({message:h.message||"Failed to load the map. Please try again.",color:"error"})}});const o=()=>{m.value=!0;const{latitude:h,longitude:y}=t.value,g={lat:h,lng:y};if(isNaN(h)||isNaN(y)){i({message:"Your current location is not available or invalid. Please check device settings.",color:"warning"}),m.value=!1;return}a.position=g,r.setCenter(g),r.setZoom(18),c&&(c.setPosition(g),c.open(r,a)),d("update:location",g),m.value=!1};return(h,y)=>(P(),A("div",null,[S("div",{ref_key:"mapDiv",ref:s,style:{width:"100%","aspect-ratio":"1 / 1"}},null,512),p(M,{text:"Update Pin to My Location",class:"text-none rounded-0",color:"error",elevation:"0","prepend-icon":"mdi-crosshairs-gps",block:"",onClick:o,loading:m.value,disabled:m.value},null,8,["loading","disabled"])]))}}),ye=B({__name:"BusinessAdd2",setup(u){const{value:e}=$("latitude"),{value:t}=$("longitude"),{value:i}=$("address"),{value:s}=$("city"),{value:r}=$("pincode"),{value:a}=$("state");function c(d){e.value=d.lat,t.value=d.lng,m(d.lat,d.lng)}async function m(d,o){const y=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${d},${o}&key=AIzaSyA-0lsPhIXOkNtMMIfvdQa77I3pCMIFd7c`,b=await(await fetch(y)).json();if(b.status!=="OK")throw new Error("Geocoding failed");const n=b.results[0].address_components,l=v=>{var _;return((_=n.find(I=>I.types.includes(v)))==null?void 0:_.long_name)||""},f=[l("subpremise"),l("premise"),[l("street_number"),l("route")].filter(Boolean).join(" "),l("neighborhood")];i.value=f.filter(Boolean).join(", "),s.value=l("locality")||l("sublocality")||l("administrative_area_level_2"),r.value=l("postal_code"),a.value=l("administrative_area_level_1")}return(d,o)=>(P(),A(F,null,[o[0]||(o[0]=S("div",{class:"text-h5 mb-4 barlow text-onSurface"},"Pinpoint Your Business on the Map",-1)),o[1]||(o[1]=S("div",{class:"text-subtitle-2 mb-4 barlow text-onSurface"}," Help customers find you easily by marking your exact location. ",-1)),o[2]||(o[2]=S("div",{class:"font-weight-bold text-subtitle-2 mb-4 barlow text-onSurface"},` Drag the pin to precisely mark your business address, or press "Update Pin to My Location" for better accuracy if you're currently at your business. `,-1)),p(ge,{"onUpdate:location":c}),o[3]||(o[3]=S("div",{class:"mt-4 text-center text-caption"}," Press 'Next' if the marker is correctly placed. ",-1))],64))}}),ve={key:0,class:"pb-2 text-caption"},be={key:2,class:"d-flex justify-end mt-4"},Pe=B({__name:"BusinessAddView",setup(u){const{refreshBusinessStatus:e}=ue(),{notify:t}=z(),i=L(!1),s=L(1),r=ie(),a=[["name","handle"],["latitude","longitude"],["address","city","pincode","state"],["email","contact"]],c=R(()=>s.value===a.length),m=R(()=>s.value/a.length*100),d=ae({name:k().required("Tell us your business name! It’s a must-have.").min(3,"Your business name should be at least 3 characters long."),handle:k().required("A unique handle is essential for your business.").matches(/^[a-zA-Z0-9_]+$/,"Handles can only contain letters, numbers, and underscores. No spaces or special characters!").test("is-unique","This handle is already taken. Please choose another one.",async n=>{if(!n)return!0;try{const{data:l,error:f}=await O.from("businesses").select("handle").eq("handle",n).limit(1);return f?(t({message:`Error checking handle uniqueness: ${f.message}`,color:"error"}),!1):l.length===0}catch(l){return t({message:`Unexpected error during handle uniqueness check: ${l}`,color:"error"}),!1}}),latitude:G().required().min(-90).max(90),longitude:G().required().min(-180).max(180),address:k().required("Your full address is required so we can locate your business."),city:k().required("Which city is your business located in? This field is required."),pincode:k().required("Please enter your 6-digit PIN code. It’s essential for accurate location.").matches(/^[1-9][0-9]{5}$/,"That doesn't look like a valid 6-digit Indian PIN code. Please check again."),state:k().required("Don't forget to tell us which state your business is in!"),email:k().email('Please enter a valid email address, like "example@domain.com".').notRequired(),contact:k().matches(/^[6-9]\d{9}$/,"Please enter a valid 10-digit Indian mobile number.").notRequired()}),{validateField:o,handleSubmit:h}=ne({validationSchema:d}),y=async n=>{i.value=!0;try{const{data:{user:l}}=await O.auth.getUser(),f={id:l.id,name:n.name,handle:n.handle,email:n.email??null,contact:n.contact??null,address:`${n.address}, ${n.city}, ${n.state} - ${n.pincode}`,location:`POINT(${n.longitude} ${n.latitude})`},{error:v}=await O.from("businesses").insert([f]);v?t({message:`Oops! Something went wrong while saving your business: ${v.message}. Please try again.`,color:"error"}):(await e(),s.value++)}catch{t({message:"An unexpected error occurred. Please try again later.",color:"error"})}finally{i.value=!1}},g=()=>{s.value===1?r.back():s.value--},b=async()=>{const n=a[s.value-1];(await Promise.all(n.map(v=>o(v)))).every(v=>v.valid)&&(c.value?h(y)():s.value++)};return(n,l)=>(P(),A(F,null,[s.value!==5?(P(),T(H,{key:0,density:"compact","scroll-behavior":"hide",elevation:"0"},{prepend:w(()=>[p(M,{icon:"mdi-arrow-left",variant:"plain",onClick:g})]),_:1})):q("",!0),p(Q,null,{default:w(()=>[p(X,{class:"mx-4 mb-4"},{default:w(()=>[s.value!==5?(P(),A("div",ve,"Create profile")):q("",!0),s.value!==5?(P(),T(ee,{key:1,class:"mb-4","model-value":m.value,color:"primary"},null,8,["model-value"])):q("",!0),p(te,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=f=>s.value=f),eager:""},{default:w(()=>[p(C,{value:1},{default:w(()=>[p(de)]),_:1}),p(C,{value:2},{default:w(()=>[p(ye)]),_:1}),p(C,{value:3},{default:w(()=>[p(oe)]),_:1}),p(C,{value:4},{default:w(()=>[p(le)]),_:1}),p(C,{value:5},{default:w(()=>[p(ce)]),_:1})]),_:1},8,["modelValue"]),s.value!==5?(P(),A("div",be,[p(M,{color:"primary",class:"text-none",loading:i.value,onClick:b},{default:w(()=>[se(re(c.value?"Done":"Next"),1)]),_:1},8,["loading"])])):q("",!0)]),_:1})]),_:1})],64))}});export{Pe as default};
